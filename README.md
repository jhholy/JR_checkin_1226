# JR泰拳馆签到系统

## 项目概述
JR泰拳馆签到系统是一个用于管理会员签到的 Web 应用，旨在简化会员签到流程、提升管理效率，并为管理员提供数据统计和分析功能。

## 更新日志

### 2023-12-26 系统优化与测试

#### 功能优化
1. **签到处理函数优化**
   - 修复了`handle_check_in`函数的参数类型问题
   - 优化了会员卡有效性检查逻辑
   - 改进了错误处理和返回消息

2. **会员卡验证逻辑优化**
   - 抽取了`check_card_validity`函数，统一处理会员卡验证
   - 完善了会员卡有效期和剩余课时的检查

3. **文档更新**
   - 添加了函数文档，详细说明了各函数的功能、参数和返回值
   - 更新了系统规则和业务流程说明

#### 测试结果
1. **签到功能测试**
   - 新会员首次签到测试通过
   - 老会员团课签到（课时卡/月卡）测试通过
   - 老会员私教签到（1对1/1对2）测试通过
   - 额外签到场景测试通过
   - 重复签到检测测试通过

2. **会员信息管理测试**
   - 会员信息创建、更新和查询测试通过
   - 会员签到历史记录查询测试通过
   - 会员卡状态查询测试通过

3. **会员卡管理测试**
   - 会员卡创建、更新和删除测试通过
   - 会员卡续费和升级测试通过
   - 会员卡有效期延长测试通过

4. **会员生命周期测试**
   - 新会员到老会员转换测试通过
   - 会员卡过期和续费流程测试通过
   - 额外签到记录和统计测试通过

## 下一步计划
1. 优化前端界面，提升用户体验
2. 增加数据统计和分析功能
3. 完善教练课时统计功能
4. 添加会员卡批量管理功能

## 相关文档
- [系统详细文档](docs/readme.md)
- [数据库结构](docs/database.md)
- [API接口文档](docs/api.md)

## 会员中心功能

会员登录后可以访问以下功能，所有数据与管理员后台保持实时同步：

1. **会员信息** `/member/profile`
   - 个人基本信息
     * 姓名
     * 邮箱
     * 联系电话
     * 注册时间
   - 实时同步
     * 与管理员后台数据源相同
     * 管理员更新后自动反映
     * 支持实时更新通知

2. **会员卡信息** `/member/card`
   - 卡片类型
     * 课程卡类型（团课/私教）
     * 剩余课时数量
     * 有效期信息
   - 卡片状态
     * 激活状态
     * 使用状态
     * 到期提醒
   - 数据同步
     * 实时显示最新课时余额
     * 自动更新卡片状态
     * 与管理系统保持一致

3. **签到记录** `/member/records`
   - 课程记录
     * 上课日期和时间
     * 课程类型（团课/私教）
     * 教练信息
   - 查询功能
     * 按日期筛选
     * 按课程类型筛选
     * 按教练筛选
   - 统计信息
     * 本月上课次数
     * 剩余课时提醒
     * 签到趋势分析

### 技术实现

1. **数据同步机制**
   ```typescript
   // 使用 Supabase 实时订阅
   const subscription = supabase
     .from('members')
     .on('UPDATE', payload => {
       // 更新本地状态
     })
     .subscribe()
   ```

2. **状态管理**
   - 使用React Context管理全局状态
   - 实时更新机制
   - 本地缓存优化

3. **数据一致性**
   - 使用乐观更新
   - 错误回滚机制
   - 冲突解决策略

### 开发注意事项

1. **数据获取**
   - 使用统一的API接口
   - 实现数据缓存机制
   - 处理加载状态和错误

2. **权限控制**
   - 验证会员身份
   - 限制数据访问范围
   - 保护敏感信息

3. **性能优化**
   - 按需加载数据
   - 实现分页机制
   - 优化更新频率

### 使用示例

```typescript
// 获取会员信息
const { memberInfo, loading, error } = useMemberInfo();

// 获取签到记录
const { records, fetchMore } = useCheckInRecords({
  limit: 10,
  offset: 0
});

// 监听卡片状态更新
useEffect(() => {
  const subscription = supabase
    .from(`member_cards:member_id=eq.${memberId}`)
    .on('UPDATE', handleCardUpdate)
    .subscribe();

  return () => subscription.unsubscribe();
}, [memberId]);
```

--By Hongyi Ji hongyiji224@gmail.com 